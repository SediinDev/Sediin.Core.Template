@using Sediin.Core.TemplateConfiguration
@inject ISediinCoreConfiguration Configuration
@model IEnumerable<Sediin.Core.DataAccess.Entities.Menu>

@functions
{

    public void CalcolaPosition(int codmenu, ref int index)
    {
        var _currentMenu = Model.FirstOrDefault(x => x.Codmenu == codmenu);

        if (_currentMenu == null)
        {
            return;
        }

        if (_currentMenu.CodmenuPadre.GetValueOrDefault() != 0)
        {
            index++;
            CalcolaPosition(_currentMenu.CodmenuPadre.GetValueOrDefault(), ref index);
        }
    }


    public string GetMenu(int padre)
    {
        var _out = "";

        var _m = Model.ToList().Where(x => x.CodmenuPadre == padre);

        var _menu = Model.ToList().FirstOrDefault(x => x.Codmenu == padre);

        if (_m.Count() == 0)
        {
            var _url = "javascript:#";
            var _onclick = "return false";

            if (!string.IsNullOrWhiteSpace(_menu.Controller) && !string.IsNullOrWhiteSpace(_menu.Action))
            {
                _url = Url.Action(_menu.Action, _menu.Controller, new { area = _menu.Area });
                _onclick = "loadContent('" + _url + "'); return false";
            }

            _out = "<a href=\"" + _url + "\" onclick=\"" + @_onclick + "\">";

            if (!string.IsNullOrWhiteSpace(_menu.IconFa))
            {
                int index = 0;
                CalcolaPosition(_menu.Codmenu, ref index);
                int _margin = 15;

                if (index > 1)
                {
                    _margin = (index - 1) * 10;
                }

                _out += "<i style=\"margin-left:" + _margin + "px !important\" class=\"" + _menu.IconFa + " mr-2" + "\"></i>";
            }

            _out += _menu.Descrizione;
            _out += "</a>";

        }

        if (_m.Count() > 0)
        {
            int index = 0;
            CalcolaPosition(_menu.Codmenu, ref index);

            _out += "<a href=\"#sidemenu_" + _menu.Codmenu + "\"  data-backend-menu=\"1\" data-bs-toggle=\"collapse\" aria-expanded=\"false\"";
            _out += "class=\"dropdown-toggle\">";

            var x = 0;

            if (index == 1)
            {
                x = 15;
            }

            if (index > 1)
            {
                x = (index - 1) * 10;
            }

            _out += "<span style=\"margin-left:" + x + "px !important\">";

            if (!string.IsNullOrWhiteSpace(_menu.IconFa))
            {
                _out += "<i class=\"" + _menu.IconFa + " mr-2\"></i>";
            }

            _out += _menu.Descrizione;
            _out += "</span></a>";

            _out += "<ul class=\"collapse list-unstyled\" id=\"sidemenu_" + _menu.Codmenu + "\">";

            foreach (var figlio in _m.OrderBy(o => o.Ordine).ToList())
            {
                _out += "<li class=\"sidebarli\">";
                _out += GetMenu(figlio.Codmenu);
                _out += "</li>";
            }

            _out += "</ul>";
        }

        return _out;
    }
}

@{
    if (Model == null)
    {
        <div class="text-info mt-5 text-center font-weight-bold">Menu non disponibile</div>
        return;
    }

    var _menupadre = Model.Where(x => (x.CodmenuPadre == 1));
}

    <ul class="list-unstyled components sidemenubackend">

        <li class="sidebar-header text-center mt-4" style="min-height:100px">

            @*         <small class="fw-bold" style="color:darkblue;">
            @Configuration.Get().Result.RagioneSociale.Nome
        </small>
 *@
            <div class="text-center">
                <img id="sediinTemplateImageLogo" class="mt-2 mb-2"
                     style="border-radius: 2%; width: 125px; mix-blend-mode: multiply;"
                     src="@Configuration.Get().Result.RagioneSociale.LogoBase64" />


            </div>

        </li>

        <li class="sidebarli">
            <a href="/Backend/Home"
               onclick="loadContent('/Backend/Home'); return false">
                <i style="margin-left:15px !important" class="fas fa-home mr-2"></i>Home
            </a>
        </li>
        @foreach (var item in _menupadre.ToList())
        {
            <li class="sidebarli">
                @Html.Raw(GetMenu(item.Codmenu))
            </li>
        }
    </ul>


