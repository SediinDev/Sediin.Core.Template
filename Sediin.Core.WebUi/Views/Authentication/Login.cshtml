@model Sediin.Core.WebUi.Models.Authentication

<link href="~/css/hideshowpassword.css" rel="stylesheet" />

<div class="row border border-1" style="min-height:460px;">
    <div class="col-md-6" style="margin:auto; text-align:center;">
        <img src="~/images/logo.png" />
    </div>

    <div class="col-md-6 mt-3 p-3">
        <h4 class="card-title"><i class="fa fa-user-lock mr-2"></i>Accesso area riservata</h4>
        <hr />

        <ajax-form asp-action="Login" 
                   asp-controller="Authentication"
                   on-begin="alertWaid()"
                   on-success="onLoginSuccess"
                   on-failure="handleError">

            <div class="form-horizontal mt-4">
                <div class="form-group">
                    <div class="col-md-12">
                        @Html.LabelFor(model => model.Username, htmlAttributes: new { @class = "control-label" })
                        @Html.TextBoxFor(model => model.Username, new { @class = "form-control col-md-12", placeholder = "Codice utente", autocomplete = "off", type = "search" })
                        @Html.ValidationMessageFor(model => model.Username, "")
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="col-md-12">
                    @Html.LabelFor(model => model.Password, htmlAttributes: new { @class = "control-label" })
                    @Html.EditorFor(model => model.Password, new { htmlAttributes = new { @class = "form-control col-md-12", placeholder = "Password" } })
                    @Html.ValidationMessageFor(model => model.Password, "")
                </div>
            </div>

            <hr />

            <div class="form-group mt-4">
                <div class="col-md-12 text-left">
                    <button type="submit" class="btn btn-info form-control">Esegui accesso</button>
                </div>
            </div>

            <hr />

            <div class="form-group row mt-4">
                <div class="col-md-12">
                    <i class="fas fa-key mr-1"></i>
                    <a class="link-black" data-ajax="true"
                       data-ajax-begin="alertWaid()"
                       data-ajax-failure="handleError"
                       data-ajax-success="showModal_NoFooter('Recupero Password', data); alertClose()" href="/Authentication/ForgotPassword">Hai dimenticato la password?</a>
                </div>

                <div class="col-md-12 mt-1">
                    <i class="fa fa-user-lock mr-1"></i>
                    <a class="link-black" data-ajax="true"
                       data-ajax-begin="alertWaid()" data-ajax-failure="handleError"
                       data-ajax-success="showModal_NoFooter('Crea una nuova utenza', data); alertClose()"
                       href="/Authentication/Register">Crea una nuova utenza</a>
                </div>
            </div>
        </ajax-form>

    </div>
</div>

@section Scripts {

    <script src="~/js/hideshowpassword.js"></script>

    <script>
        $(document).ready(function () {
            $('#Password').hideShowPassword({
                innerToggle: true
            });
        });

        function onLoginSuccess(data) {
            if (data.success) {

                alertSuccessNoCloseButton(data.message);

                setTimeout(function () {
                    window.location.href = "/Backend/Home";
                }, 1000);

            } else {
                //vai a authenticazione due fattori

               // $('#loginResult').html('<div class="alert alert-danger">' + response.message + '</div>');
            }
        }

    </script>
}


